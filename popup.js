function updateUI(enabled, hasData) { const btn = document.getElementById('mainAction'); const form = document.getElementById('setup-form'); if (enabled) { btn.textContent = 'Disable'; btn.classList.add('secondary'); form.style.display = 'none'; } else { btn.textContent = 'Enable'; btn.classList.remove('secondary'); form.style.display = 'block'; btn.disabled = !hasData; } } document.getElementById('mainAction').addEventListener('click', function() { const url = document.getElementById('url').value.trim(); const user = document.getElementById('username').value.trim(); const pass = document.getElementById('password').value; chrome.storage.local.get(['enabled'], (res) => { const currentlyEnabled = res.enabled || false; if (!currentlyEnabled) { if (!url || !user || !pass) { alert('Please fill in all fields first.'); return; } chrome.storage.local.set({ url, username: user, password: pass, enabled: true }, () => { updateUI(true, true); chrome.tabs.query({}, (tabs) => { tabs.forEach(tab => { chrome.tabs.sendMessage(tab.id, { action: "CHECK_LOGIN" }).catch(() => {}); }); }); }); } else { chrome.storage.local.set({ enabled: false, url: '', username: '', password: '' }, () => { document.getElementById('url').value = ''; document.getElementById('username').value = ''; document.getElementById('password').value = ''; updateUI(false, false); }); } }); }); ['url', 'username', 'password'].forEach(id => { document.getElementById(id).addEventListener('input', function() { const url = document.getElementById('url').value.trim(); const user = document.getElementById('username').value.trim(); const pass = document.getElementById('password').value; chrome.storage.local.set({ url, username: user, password: pass }); chrome.storage.local.get(['enabled'], (res) => { updateUI(res.enabled || false, !!(url && user && pass)); }); }); }); const showBtn = document.getElementById('showPassword'); const passField = document.getElementById('password'); showBtn.addEventListener('mousedown', (e) => { e.preventDefault(); passField.type = 'text'; }); showBtn.addEventListener('mouseup', () => { passField.type = 'password'; }); showBtn.addEventListener('mouseleave', () => { passField.type = 'password'; }); chrome.storage.local.get(['enabled', 'url', 'username', 'password'], (res) => { const enabled = res.enabled || false; const hasData = !!(res.url && res.username && res.password); document.getElementById('url').value = res.url || ''; document.getElementById('username').value = res.username || ''; document.getElementById('password').value = res.password || ''; updateUI(enabled, hasData); });
