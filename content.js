const sleep = (ms) => new Promise(res => setTimeout(res, ms)); async function autoLogin() { const store = await chrome.storage.local.get(['url', 'username', 'password', 'enabled']); if (!store.enabled) return; if (!store.url || !store.username || !store.password) return; if (!window.location.href.includes(store.url)) return; await sleep(300); const usernameField = document.querySelector('input[type="text"], input[type="email"], input[name="username"], input[name="user"], input[name="email"], input[name="login"]'); if (!usernameField) return; usernameField.focus(); usernameField.value = store.username; usernameField.dispatchEvent(new Event('input', { bubbles: true })); await sleep(300); const passwordField = document.querySelector('input[type="password"]'); if (!passwordField) return; passwordField.focus(); passwordField.value = store.password; passwordField.dispatchEvent(new Event('input', { bubbles: true })); await sleep(300); const loginButton = Array.from(document.querySelectorAll('button, input[type="submit"], a[role="button"], button[type="submit"]')).find(el => { const text = (el.innerText || el.value || el.textContent || '').trim().toLowerCase().replace(/\s+/g, ''); return text.includes('login') || text.includes('signin') || text.includes('ورود') || text.includes('submit') || text.includes('log in') || text.includes('sign in'); }); if (loginButton) loginButton.click(); } if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', autoLogin); } else { autoLogin(); } window.addEventListener('popstate', autoLogin); chrome.storage.onChanged.addListener((changes, area) => { if (area === 'local' && changes.enabled) { if (changes.enabled.newValue === true) { autoLogin(); } } });
